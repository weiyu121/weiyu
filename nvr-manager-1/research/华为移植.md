# 系统

* 开发板：Atlas 200I DK A2
* 系统：Ubuntu 22.04

开发资料与文档：[https://www.hiascend.com/document/detail/zh/Atlas200IDKA2DeveloperKit/23.0.RC1/pd/pd_0001.html](https://www.hiascend.com/document/detail/zh/Atlas200IDKA2DeveloperKit/23.0.RC1/pd/pd_0001.html)

# 网络

[修改接口IP地址-配置网络-硬件接口使用指南-...-文档首页-昇腾社区 (hiascend.com)](https://www.hiascend.com/document/detail/zh/Atlas200IDKA2DeveloperKit/23.0.RC1/Hardware%20Interfaces/hiug/hiug_0058.html)

[Ubuntu 18.04/20.04/22.04 使用教程 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/601418015)

原始系统使用netplan+networkd进行网络管理，而软件使用NetworkManager+nmcli进行网络管理，因此需要更改系统的网络管理方式。

将 `/etc/netplan/*.yaml`内容修改为如下（原始内容请备份）：

```yaml
network:
  version: 2
  renderer: NetworkManager
```

将 `/etc/NetworkManager/NetworkManager.conf`中的m `anaged=true`修改为 `true`：

```plaintext
[main]
plugins=ifupdown,keyfile

[ifupdown]
managed=true

[device]
wifi.scan-rand-mac-address=no
```

删除之前遗留的connections文件（删之前请备份）：

```bash
rm /etc/NetworkManager/system-connections/* -f
```

然后直接重启板子，即可看到nmcli创建了两个有线网络的连接，可以按照nmcli的方式进行网络设置：

```plaintext
(base) root@davinci-mini:~# nmcli c
NAME                UUID                                  TYPE      DEVICE
Wired connection 1  d100454d-4e43-347f-a980-202477825b44  ethernet  eth0
Wired connection 2  e337fa84-6d5a-3467-b372-33d6fda4319b  ethernet  --
```

上面操作后，bond0与usb0这两张网卡仍然处于unmanaged状态，还不知道如何使用：

```
(base) root@davinci-mini:~# nmcli dev
DEVICE  TYPE      STATE        CONNECTION
eth0    ethernet  connected    Wired connection 1
eth1    ethernet  unavailable  --
bond0   bond      unmanaged    --
usb0    ethernet  unmanaged    --
lo      loopback  unmanaged    --
```

## 未解决问题

系统重启后，没有应用全部的nmcli有线配置（或者也可能是被别的东西覆盖了），后果是开机后虽然ipv4地址是静态且正确的，但dns设置没有应用，导致没法解析域名，需要重新 `nmcli c up <有线连接>`才能上网，并且应用所有nmcli连接配置。

# AI程序

修改：需要使用镜像中预制的miniconda中的 `base`环境，其中已经预安装torch、mindx....

但是需要先激活 `/usr/local/Ascend/mxVision/set_env.sh`环境变量，如果能在pythonAI程序代码中激活或者修改更好，这样nvr-manager中启动AI任务就不用动了。

# 待解决

## 日志目录/文件消失

nginx的日志文件目录和mysql的日志文件目录分别在/var/log/nginx和/var/log/mysql
系统重启后，/var/log/nginx和/var/log/mysql目录都会消失，需要执行如下命令来重启：

```bash
mkdir /var/log/nginx
mkdir /var/log/mysql
touch /var/log/mysql/error.log
chmod 777 /var/log/mysql -R
systemctl start nginx
systemctl start mysql
systemctl start nvr-manager
```

推测：和它在/var/log目录上挂载tmpfs有关