(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f4a5164"],{4984:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"main-content"},[n("a-card",["11d6d3b38cb8e05e006cec88e992c237d327c3e0"===t.userPassword?[n("div",{staticClass:"table-operator"},[n("a-button",{attrs:{slot:"extra",type:"primary"},on:{click:function(e){return t.linkTo(1,1)}},slot:"extra"},[n("a-icon",{attrs:{type:"plus"}}),t._v("新增AI服务 ")],1)],1)]:t._e(),n("a-table",{attrs:{columns:t.columns,dataSource:t.pageData.records,loading:t.pageData.tableLoading,pagination:!1},scopedSlots:t._u([{key:"name",fn:function(e,a){return n("span",{},[t._v(" "+t._s(e)+" "),a.default?[n("a-tag",{staticStyle:{"margin-left":"24px"},attrs:{size:"small",color:"orange"}},[t._v(t._s("默认AI服务"))])]:t._e()],2)}},{key:"createTime",fn:function(e){return n("span",{},[t._v(" "+t._s(t._f("moment")(e))+" ")])}},{key:"status",fn:function(e){return n("span",{},[n("a-tag",{attrs:{color:t.proStatus[e].color}},[t._v(t._s(t.proStatus[e].label||"--"))])],1)}},{key:"action",fn:function(e,a){return n("span",{},[n("a",{on:{click:function(e){return e.stopPropagation(),t.upgradeServe(a.id,a.name)}}},[t._v("服务升级")]),n("a-divider",{attrs:{type:"vertical"}}),n("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(e){return t.batchDelete(a.id)},click:function(t){t.stopPropagation()}}},[n("a",{staticStyle:{color:"#ff4d4f"},on:{click:function(t){t.stopPropagation()}}},[t._v("删除")])]),a.default?t._e():[n("a-divider",{attrs:{type:"vertical"}}),n("a-popconfirm",{attrs:{title:"确定设置该AI服务为默认服务吗?"},on:{confirm:function(e){return t.setAIServerDefault(a.id)},click:function(t){t.stopPropagation()}}},[n("a",{staticStyle:{color:"orange"},on:{click:function(t){t.stopPropagation()}}},[t._v("设置为默认服务")])])]],2)}}])})],2),n("a-drawer",{attrs:{title:t.infoDialog.title,visible:t.infoDialog.show,width:"600px",center:""},on:{"update:visible":function(e){return t.$set(t.infoDialog,"show",e)},close:function(e){t.infoDialog.show=!1}}},[n(t.infoDialog.component,{tag:"component",attrs:{"current-info":t.infoDialog},on:{emitToParent:t.getChildValue}})],1)],1)},o=[],r=(n("d3b7"),n("3ca3"),n("ddb0"),n("b0c0"),n("4160"),n("159b"),n("a434"),n("4795"),n("7db0"),n("52bb")),i=n("abc2"),c=[{title:"名称",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"版本",dataIndex:"version",width:"15%"},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"描述",dataIndex:"description",ellipsis:!0},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],u=[{title:"监控",dataIndex:"device_id",scopedSlots:{customRender:"camera"}},{title:"状态",dataIndex:"running",scopedSlots:{customRender:"running"}},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],s={Succeeded:{color:"green",label:"成功"},Initializing:{color:"cyan",label:"初始化中"},Failed:{color:"orange",label:"初始化失败"}},d={components:{Info:function(){return n.e("chunk-2d22be09").then(n.bind(null,"f19a"))},Config:function(){return n.e("chunk-2d2253cb").then(n.bind(null,"e417"))},Log:function(){return n.e("chunk-022a20e1").then(n.bind(null,"8ffd"))},Upgrade:function(){return n.e("chunk-2d0aa275").then(n.bind(null,"1099"))},UpgradeModel:function(){return n.e("chunk-2d0d79cd").then(n.bind(null,"780f"))}},data:function(){return{proStatus:s,taskLoading:!1,taskList:[],taskColumns:u,expandedRowKeys:[],columns:c,queryParam:{},pageData:{tableLoading:!1,records:[]},infoDialog:{component:"Info",show:!1,title:"AI服务",type:"add",id:""},userPassword:localStorage.getItem("userkey"),cameraMap:{}}},created:function(){this.getList(),this.getCameraData()},methods:{setAIServerDefault:function(t){var e=this;Object(r["o"])({ai_project_id:t}).then((function(t){0===t.code?(e.$message.success("设置成功！"),e.getList()):e.$message.error(t.message)}))},getCameraName:function(t){var e=this;Object(i["f"])({id:t}).then((function(n){e.$set(e.cameraMap,t,n.name)}))},getCameraData:function(){var t=this;Object(i["g"])().then((function(e){var n={},a=e.device_list||[];a.forEach((function(t){n[t.id]=t.name})),t.cameraMap=n}))},updateTaskList:function(){var t=this.expandedRowKeys;t&&t.length||(this.expandedRowKeys=[],this.taskList=[])},stopTask:function(t,e){var n=this,a=this.cameraMap[e]||"";this.$confirm({title:"系统提示",content:"确定停止 "+a+" 任务吗?",onOk:function(){n.$message.loading({content:"任务停止中，请稍后...",key:"task"}),Object(r["q"])({id:t}).then((function(t){n.$message.success({content:a+"停止成功！",key:"task"}),n.updateTaskList()}))["catch"]((function(){n.$message.close()}))}})},startTask:function(t,e){var n=this,a=this.cameraMap[e]||"";this.$confirm({title:"系统提示",content:"确定启动 "+a+" 任务吗?",onOk:function(){n.$message.loading({content:"任务启动中，请稍后...",key:"task"}),Object(r["p"])({id:t}).then((function(t){n.$message.success({content:a+"启动成功！",key:"task"}),n.updateTaskList()}))["catch"]((function(){n.$message.destroy()}))}})},upgradeServe:function(t,e){this.infoDialog={component:"Upgrade",show:!0,title:"服务升级："+e,project_name:e,id:t}},deleteType:function(t,e){var n=this;Object(r["c"])({id:t}).then((function(t){n.$message.success("删除成功！"),n.taskList.splice(e,1)}))},getChildValue:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.infoDialog.show=!1,t&&setTimeout((function(){e.getList()}),60*n*1e3)},resetForm:function(){this.queryParam={},this.pagination.pageSize=10,this.pagination.current=1,this.getList()},searchList:function(){this.pagination.pageSize=10,this.pagination.current=1,this.getList()},handleRowsChange:function(t){if(!t||!t.length)return this.expandedRowKeys=[],void(this.taskList=[]);var e=t[t.length-1];this.expandedRowKeys=[e]},getTaskList:function(t){var e=this;this.taskLoading=!0,Object(r["f"])({project_id:t}).then((function(t){e.taskList=t.ai_task_list||[],e.taskList.forEach((function(t){e.cameraMap[t.device_id]||e.getCameraName(t.device_id)}))}))["finally"]((function(){e.taskLoading=!1}))},getList:function(){var t=this;this.pageData.tableLoading=!0,Object(r["k"])().then((function(e){var n=e.ai_project_list||[];t.pageData.records=n;var a=t.expandedRowKeys[0],o=n.find((function(t){return t.id===a}))||n[0]||{};o.id?t.$set(t.expandedRowKeys,0,o.id):(t.expandedRowKeys=[],t.taskList=[])}))["finally"]((function(e){t.pageData.tableLoading=!1}))},devModal:function(t){this.$message.warning("开发中！")},linkToLog:function(t,e){this.infoDialog={component:"Log",show:!0,title:"日志："+this.cameraMap[e],id:t}},upgradeModel:function(t,e,n){this.infoDialog={component:"UpgradeModel",show:!0,title:"模型升级："+e,project_name:e,modelId:n,id:t}},linkToConfig:function(t,e,n,a){this.infoDialog={component:"Config",show:!0,isAdd:t,title:t?"新增监控："+n:"配置监控："+this.cameraMap[n],projectId:e,id:a}},linkTo:function(t,e,n){this.infoDialog={component:"Info",show:!0,isAdd:t,title:t?"新增AI服务":"修改AI服务："+n,id:e}},batchDelete:function(t){var e=this;Object(r["d"])({id:t}).then((function(t){e.$message.success("删除成功！"),e.getList()}))}}},l=d,f=n("2877"),p=Object(f["a"])(l,a,o,!1,null,null,null);e["default"]=p.exports},"52bb":function(t,e,n){"use strict";n.d(e,"t",(function(){return d})),n.d(e,"n",(function(){return l})),n.d(e,"k",(function(){return f})),n.d(e,"d",(function(){return p})),n.d(e,"j",(function(){return m})),n.d(e,"s",(function(){return h})),n.d(e,"b",(function(){return b})),n.d(e,"f",(function(){return g})),n.d(e,"e",(function(){return k})),n.d(e,"c",(function(){return j})),n.d(e,"o",(function(){return v})),n.d(e,"p",(function(){return O})),n.d(e,"q",(function(){return y})),n.d(e,"a",(function(){return w})),n.d(e,"r",(function(){return L})),n.d(e,"g",(function(){return _})),n.d(e,"l",(function(){return D})),n.d(e,"m",(function(){return I})),n.d(e,"h",(function(){return S})),n.d(e,"i",(function(){return x}));n("d3b7");var a=n("bc3a"),o=n.n(a),r=n("4360"),i=n("56cd"),c=(n("a27e"),o.a.create({baseURL:"/model",timeout:12e4})),u="request-error";c.interceptors.request.use((function(t){return t}),(function(t){Promise.reject(t)})),c.interceptors.response.use((function(t){var e=t.data;switch(e.code){case 0:return e;case 1:r["a"].dispatch("Logout",{isReqLogOut:!1}).then((function(t){location.reload()}))}return i["a"].warning({key:u,message:e.message||"网络连接超时！",duration:2}),Promise.reject(e)}),(function(t){return i["a"].warning({key:u,message:"网络连接超时！",duration:2}),Promise.reject(t)}));var s=n("b775");function d(t){return Object(s["b"])({url:"/ai-task/"+t.id+"/alert",method:"patch",data:t})}function l(t){return Object(s["b"])({url:"/ai-task/"+t.id+"/alert",method:"get"})}function f(t){return Object(s["b"])({url:"/ai-project",method:"get",params:t})}function p(t){return Object(s["b"])({url:"/ai-project/"+t.id,method:"delete"})}function m(t){return Object(s["b"])({url:"/ai-project/"+t.id,method:"get",params:t})}function h(t,e){return Object(s["b"])({url:"/ai-project/"+t.id,method:"patch",data:e})}function b(t){return Object(s["b"])({url:"/ai-project",method:"post",data:t})}function g(t){return Object(s["b"])({url:"/ai-task",method:"get",params:t})}function k(t){return Object(s["b"])({url:"/ai-task/"+t.id,method:"get"})}function j(t){return Object(s["b"])({url:"/ai-task/"+t.id,method:"delete"})}function v(t){return Object(s["b"])({url:"/ai-project/default",method:"patch",data:t})}function O(t){return Object(s["b"])({url:"/ai-task/"+t.id+"/start",method:"post"})}function y(t){return Object(s["b"])({url:"/ai-task/"+t.id+"/stop",method:"post"})}function w(t){return Object(s["b"])({url:"/ai-task",method:"post",data:t})}function L(t){return Object(s["b"])({url:"/ai-task/"+t.id,method:"patch",data:t})}function _(t){return Object(s["b"])({url:"/ai-task/"+t.id+"/status",method:"get",params:t})}function D(t,e){return Object(s["b"])({url:"/ai-project/"+t.id+"/model",method:"patch",data:e})}function I(t,e){return Object(s["b"])({url:"/ai-project/"+t.id,method:"patch",data:e})}function S(t){return Object(s["b"])({url:"system/modelhub/list",method:"get",params:t})}function x(t){return c({url:"/openapi/selectVersionByModelId",method:"get",params:t})}},abc2:function(t,e,n){"use strict";n.d(e,"j",(function(){return o})),n.d(e,"o",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return u})),n.d(e,"d",(function(){return s})),n.d(e,"f",(function(){return d})),n.d(e,"p",(function(){return l})),n.d(e,"b",(function(){return f})),n.d(e,"n",(function(){return p})),n.d(e,"m",(function(){return m})),n.d(e,"c",(function(){return h})),n.d(e,"q",(function(){return b})),n.d(e,"e",(function(){return g})),n.d(e,"i",(function(){return k})),n.d(e,"l",(function(){return j})),n.d(e,"k",(function(){return v}));var a=n("b775");function o(){return Object(a["b"])({url:"/usbcam-search",method:"get"})}function r(t){return Object(a["b"])({url:"/cloud/forward/"+t+"/start",method:"post"})}function i(t){return Object(a["b"])({url:"/cloud/forward/"+t+"/stop",method:"post"})}function c(t){return Object(a["b"])({url:"/device",method:"get",params:t})}function u(t){return Object(a["b"])({url:"/camera",method:"get",params:t})}function s(t){return Object(a["b"])({url:"/camera/"+t.id,method:"delete"})}function d(t){return Object(a["b"])({url:"/camera/"+t.id,method:"get"})}function l(t,e){return Object(a["b"])({url:"/camera/"+t.id,method:"patch",data:e})}function f(t,e){return Object(a["b"])({url:"/camera",method:"post",data:e})}function p(t){return Object(a["b"])({url:"/source",method:"get",params:t})}function m(t){return Object(a["b"])({url:"/source/"+t.id,method:"get"})}function h(t,e){return Object(a["b"])({url:"/source",method:"post",data:e})}function b(t,e){return Object(a["b"])({url:"/source/"+t.id,method:"patch",data:e})}function g(t){return Object(a["b"])({url:"/source/"+t.id,method:"delete"})}function k(t){return Object(a["b"])({url:"/camera-search",method:"get",params:t})}function j(t){return Object(a["b"])({url:"/dvr/records",method:"get",params:t})}function v(t){return Object(a["b"])({url:"/dvr/date",method:"get",params:t})}}}]);