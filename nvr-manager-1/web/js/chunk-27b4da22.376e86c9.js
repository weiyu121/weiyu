(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27b4da22"],{"0f50":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main"},[i("div",{staticClass:"operation"},[i("div",{staticClass:"button-wrap1"},[i("a-button",{attrs:{type:"primary",icon:"save",disabled:""===e.imgUrl},on:{click:e.drawEnd}},[e._v("保存绘制")]),i("a-button",{on:{click:function(t){return e.updateMap(!0)}}},[e._v("重置")]),i("a-button",{attrs:{disabled:e.isOverThree},on:{click:function(t){return e.setMode("RECT")}}},[e._v("矩形")]),i("a-button",{attrs:{disabled:e.isOverThree},on:{click:function(t){return e.setMode("POLYGON")}}},[e._v("多边形")]),i("a-button",{on:{click:function(t){return e.Revoke()}}},[e._v("撤销")])],1)]),i("div",{attrs:{id:"map"}},[i("div",{staticClass:"mark-res"},[i("span",{staticStyle:{"font-size":"18px",color:"red",position:"relative","z-index":"999"}},[e._v(" "+e._s()+" ")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],staticClass:"menu",attrs:{id:"contextmenu"}},[i("div",{staticClass:"title"},[e._v(" 区域名称："),i("a-input",{ref:"labelNameRef",staticStyle:{width:"65%","margin-right":"6px"},attrs:{value:"",placeholder:"回车保存"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.editFeature.apply(null,arguments)}}}),i("a-icon",{staticStyle:{"font-size":"16px",cursor:"pointer"},attrs:{type:"close"},on:{click:e.deleteFeature}})],1),i("div",{staticClass:"content"}),i("div",{staticClass:"foot"})])])])},r=[],s=i("54f8"),n=(i("d3b7"),i("3ca3"),i("ddb0"),i("b0c0"),i("cb29"),i("ac1f"),i("5319"),i("0d03"),i("25f0"),i("7e66")),o=i.n(n),l={name:"AILabel",components:{FlvPlayer:function(){return Promise.all([i.e("flv.js"),i.e("chunk-e629b6fa")]).then(i.bind(null,"f4a0"))}},props:{imgUrl:{type:String,default:""},regionInfo:{type:Array,default:function(){return[]}}},data:function(){return{menuVisible:!1,drawingStyle:{},imgSize:{width:500,height:300},mode:"",itemName:"",isOverThree:!1,editId:"",deleteIconId:"delete01",isEditFeature:!1}},watch:{imgUrl:{handler:"updateMap"},mode:function(e){this.gMap.setMode(e),this.setDrawingStyle(e),this.$emit("emitToParent",this.allFeatures)}},created:function(){this.gMap=null,this.gFirstFeatureLayer=null,this.gFirstTextLayer=null,this.allFeatures=null,this.allTexts=null},beforeDestroy:function(){this.$message.destroy(),this.reSet()},methods:{deleteFeature:function(){if(this.editId){var e=this.gFirstFeatureLayer.getFeatureById(this.editId);this.gFirstTextLayer.removeTextById(e.id),this.gFirstFeatureLayer.removeFeatureById(e.id),this.isEditFeature=!0,this.menuVisible=!1}},editFeature:function(e){var t=e.target.value,i=this.gFirstFeatureLayer.getFeatureById(this.editId);this.gFirstTextLayer.removeTextById(i.id),this.gFirstFeatureLayer.removeFeatureById(i.id);var a=i.shape;a&&a.points&&(a=a.points),this.addFeature(a,i.type,t),this.isEditFeature=!0,this.menuVisible=!1,this.judgeFeatureLength()},showAnnoName:function(e){var t=e.shape,i=e.id,a=e.type,r=e.props.labelName,s=0,n=0;"RECT"===a?(s=t.x,n=t.y):(s=t.points[0].x,n=t.points[0].y);var l=new o.a.Text(i,{text:r,position:{x:s,y:n},offset:{x:0,y:0}},{name:"标注名称"},{background:!0,globalAlpha:.5,fontColor:"#0f0"});this.gFirstTextLayer.addText(l)},updateMap:function(e){if(e&&this.reSet(),null==this.gMap){var t=this,i=new o.a.Map("map",{center:{x:this.imgSize.width/2,y:this.imgSize.height/2},zoom:500,mode:"PAN",refreshDelayWhenZooming:!0,zoomWhenDrawing:!0,panWhenDrawing:!0,zoomWheelRatio:5,withHotKeys:!0});t.gMap=i,this.addEvent()}var a=new o.a.Layer.Image("first-layer-image",{src:this.imgUrl,width:this.imgSize.width,height:this.imgSize.height,crossOrigin:!1,position:{x:0,y:0}},{name:"第一个图片图层"},{zIndex:5});this.gMap.addLayer(a);var r=new o.a.Layer.Feature("first-layer-feature",{name:"第一个矢量图层"},{zIndex:10,opacity:.5,fill:!0});this.gFirstFeatureLayer=r,this.gMap.addLayer(r);var n=new o.a.Layer.Text("first-layer-text",{name:"第一个文本图层"},{zIndex:12,opacity:1});if(this.gFirstTextLayer=n,this.gMap.addLayer(n),null!=this.regionInfo&&!0!==e){var l,d=Object(s["a"])(this.regionInfo);try{for(d.s();!(l=d.n()).done;){var u=l.value,h=u.region,c=u.name;this.setDrawingStyle("POLYGON");for(var g=[],y=h,f=this.imgSize,p=f.width,v=f.height,F=0;F<y.length;F+=2)g.push({x:y[F]*p,y:y[F+1]*v});this.addFeature(g,"POLYGON",c)}}catch(m){d.e(m)}finally{d.f()}}this.judgeFeatureLength(),this.mode="PAN",window.onresize=function(){this.gMap&&this.gMap.resize()}},addFeature:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=this,r=this.drawingStyle,s=i,n=a.getUId();if("RECT"===t){var l=new o.a.Feature.Rect(n,e,{labelName:s},r);a.gFirstFeatureLayer.addFeature(l),a.editId=l.id,a.showAnnoName(l)}else if("POLYGON"===t){var d=new o.a.Feature.Polygon(n,{points:e},{labelName:s},r);a.gFirstFeatureLayer.addFeature(d),a.showAnnoName(d)}else if("CLEARMASK"===t){var u=new o.a.Mask.Clear("first-action-clear",{points:e,width:5});a.gFirstMaskLayer.addAction(u)}this.editId=n,this.getFeatures()},addDeleteIcon:function(e,t){var i=this.gMap,a=this,r=new o.a.Marker(a.deleteIconId,{src:"https://s1.aigei.com/src/img/png/45/45aabfc232a34e5b9bfaf75412973c08.png?|watermark/3/image/aHR0cHM6Ly9zMS5haWdlaS5jb20vd2F0ZXJtYXJrLzUwMC0xLnBuZz9lPTE3MzU0ODgwMDAmdG9rZW49UDdTMlhwemZ6MTF2QWtBU0xUa2ZITjdGdy1vT1pCZWNxZUpheHlwTDpjYWQ1NHVoRlhGUUViSGR3Vm02aXctVTJoWVE9/dissolve/40/gravity/NorthWest/dx/18/dy/21/ws/0.0/wst/0&e=1735488000&token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:C11LKqsRLbAqQo2uVPETYDya0QU=",position:{x:t.x+t.width,y:t.y-15},offset:{x:-20,y:-4}},{name:"delete"});r.events.on("click",(function(t){i.markerLayer.removeMarkerById(t.id),a.gFirstFeatureLayer.removeFeatureById(e.id)})),i.markerLayer.addMarker(r)},deIcon:function(){this.gMap.markerLayer.removeAllMarkers()},addEditor:function(e,t){var i=document.getElementById("contextmenu");i.style.left=event.clientX+"px",i.style.top=event.clientY+"px",this.menuVisible=!0,this.$refs["labelNameRef"].focus()},judgeFeatureLength:function(){this.allFeatures&&this.allFeatures.length>=3?(this.isOverThree=!0,this.mode="PAN"):this.isOverThree=!1},addEvent:function(){var e=this,t=this,i=this.gMap;i.events.on("drawDone",(function(e,i){"CLEARMASK"===e||"DRAWMASK"===e?t.addFeature(i,e):(t.addFeature(i,e,e.value),t.addEditor(i.x,i.y))})),i.events.on("boundsChanged",(function(e){return""})),i.events.on("featureSelected",(function(a){e.editId=a.id,i.setActiveFeature(a);var r=a.type,s=a.shape;if("POINT"!==r){var n=0,o=0;"RECT"===r?(n=s.x,o=s.y):"POLYGON"===r&&(n=s.points[0].x,o=s.points[0].y),t.addEditor(n,o)}})),i.events.on("featureDeleted",(function(e){"POINT"===e.type&&t.gFirstFeatureLayer.removeFeatureById(e.id)})),i.events.on("featureUnselected",(function(){t.editId="",t.deIcon(),i.setActiveFeature(null)})),i.events.on("featureUpdated",(function(e,i){t.deIcon(),e.updateShape(i),"POINT"!==e.type&&t.addDeleteIcon(e,i)})),i.events.on("FeatureDeleted",(function(){}))},reSet:function(){this.gMap&&(this.gMap.destroy(),this.gMap=void 0),this.gFirstFeatureLayer&&(this.gFirstFeatureLayer=void 0),this.gFirstTextLayer&&(this.gFirstTextLayer=void 0),this.allFeatures&&(this.allFeatures=void 0),this.allTexts&&(this.allTexts=void 0),this.isOverThree=!1},getPoints:function(e){switch(e.type){case"RECT":return e.getPoints();case"POLYGON":return e.shape.points;default:return[]}},Fill:function(){var e=this.gFirstFeatureLayer.getFeatureById(this.editId);e.style.fillStyle="#FFDAB9",e.style.fill=!0,this.gMap.refresh()},Revoke:function(){this.getFeatures(),this.getTexts(),this.allFeatures.pop(),this.allTexts.pop(),this.judgeFeatureLength(),this.gMap.refresh()},drawEnd:function(){var e={allFeatures:this.allFeatures,imgSize:this.imgSize};this.$emit("emitToParent",e)},zoomIn:function(){this.gMap.zoomIn()},zoomOut:function(){this.gMap.zoomOut()},setMode:function(e){this.mode=e},getFeatures:function(){this.allFeatures=this.gFirstFeatureLayer.getAllFeatures()},getTexts:function(){this.allTexts=this.gFirstTextLayer&&this.gFirstTextLayer.getAllTexts()},setDrawingStyle:function(e){var t={};switch(e){case"PAN":break;case"RECT":this.drawingStyle={strokeStyle:"#0f0",lineWidth:1,fill:!0,fillStyle:"#FF6666",globalAlpha:.3},this.gMap.setDrawingStyle(t);break;case"POLYGON":this.drawingStyle={strokeStyle:"#0099CC",fill:!0,fillStyle:"#FF6666",globalAlpha:.3,lineWidth:3,stroke:!0},this.gMap.setDrawingStyle(t);break;case"CLEARMASK":this.drawingStyle={fillStyle:"#00f",lineWidth:30},this.gMap.setDrawingStyle(t);break;default:break}},getUId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)}))}}},d=l,u=(i("6145"),i("2877")),h=Object(u["a"])(d,a,r,!1,null,"7806aa53",null);t["default"]=h.exports},6145:function(e,t,i){"use strict";i("fbb9")},fbb9:function(e,t,i){}}]);