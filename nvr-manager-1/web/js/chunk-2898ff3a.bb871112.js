(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2898ff3a"],{"093a":function(e,t,n){"use strict";n.d(t,"g",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"h",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return d}));var a=n("b775");function i(e){return Object(a["b"])({url:"/camera/"+e.id+"/ptz",method:"post",data:e.data})}function r(e){return Object(a["b"])({url:"/ai-task/"+e+"/region",method:"get"})}function o(e){return Object(a["b"])({url:"/ai-task/"+e.id+"/region",method:"patch",data:e.data})}function c(){return Object(a["b"])({url:"/device",method:"get"})}function s(e){return Object(a["b"])({url:"/device/"+e,method:"get"})}function u(e){return Object(a["b"])({url:"/alert",method:"get",params:e})}function l(e){return Object(a["b"])({url:"/alert/count",method:"get",params:e})}function d(){return Object(a["b"])({url:"/monitor",method:"get"})}},"2b65":function(e,t,n){"use strict";n("79ef")},"79ef":function(e,t,n){},d851:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main-content"},[n("a-card",{staticClass:"table-search"},[n("a-form",{attrs:{layout:"inline"}},[n("a-form-item",{attrs:{label:"选择监控"}},[n("a-select",{staticStyle:{width:"280px"},attrs:{"show-search":"",placeholder:"请选择"},on:{change:e.handleCameraChange},model:{value:e.deviceId,callback:function(t){e.deviceId=t},expression:"deviceId"}},e._l(e.cameras,(function(t){return n("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1)],1),n("a-row",{attrs:{gutter:[32,8]}},[n("a-col",{attrs:{span:16}},[n("a-card",{staticStyle:{height:"900px",width:"100%"}},[n("AI-Label",{attrs:{"img-url":e.img,"region-info":e.region},on:{emitToParent:e.getChildValue}})],1)],1),n("a-col",{attrs:{span:8}},[n("a-card",{staticStyle:{height:"900px",overflow:"auto"},attrs:{title:e.infoDialog.title}},[void 0===e.deviceId?[n("a-empty",{attrs:{description:"请选择监控"}})]:e.infoDialog.AIId?[n(e.infoDialog.component,{tag:"component",staticStyle:{height:"100%"},attrs:{"current-info":e.infoDialog,"region-info":e.region},on:{emitToParent:e.getChildValue}})]:[n("a-empty",{attrs:{description:"请为监控配置AI服务"}})]],2)],1)],1)],1)},i=[],r=n("c964"),o=n("54f8"),c=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("b0c0"),n("4160"),n("159b"),n("ca00")),s=n("093a"),u="/api",l=[[0,1,0],[0,-1,0],[-1,0,0],[1,0,0],[-1,1,0],[1,1,0],[1,-1,0],[-1,-1,0],[0,0,1],[0,0,-1]],d={components:{AILabel:function(){return Promise.all([n.e("ailabel"),n.e("chunk-27b4da22")]).then(n.bind(null,"0f50"))},WarningConfig:function(){return n.e("chunk-c9f66cea").then(n.bind(null,"8073"))}},data:function(){return{direct:l,baseApi:u,cameraLoading:!1,deviceId:void 0,draw:!1,dateList:[],cameras:[],camerasMap:{},region:[],img:"",infoDialog:{component:"WarningConfig",show:!0,title:"配置监控",id:""},form:{confirmLoading:!1,val:{enable:!0,highlight:!0}}}},created:function(){this.getAllCameraData()},mounted:function(){},methods:{cameraRegionSetting:function(e){var t=this,n={id:this.deviceId,data:{enable:this.form.val.enable,highlight:this.form.val.highlight}};Object(s["h"])(n).then((function(e){0===e.code?t.$message.success("设置成功！"):t.$message.error("设置失败！")}))["finally"]((function(){t.getCameraImg(t.deviceId)}))},getChildValue:function(e){e&&e["allFeatures"]&&this.setIntrusion(e)},getRegionParams:function(e,t,n){var a,i=e.allFeatures,r=e.imgSize,c=n.enable,s=n.highlight,u=[],l=Object(o["a"])(i);try{for(l.s();!(a=l.n()).done;){var d=a.value,h=d.type,g=d.shape,f=d.props,m=[];if("RECT"===h){var b=g.x,p=g.y,v=g.height,I=g.width;m=[b,p,b+I,p,b+I,p+v,b,p+v]}else for(var C=g.points,w=0;w<C.length;w++)m.push(C[w].x),m.push(C[w].y);for(var j=[],y=0;y<m.length;y++){var O=m[y];O/=y%2===0?r.width:r.height,j.push(O)}u.push({name:f.labelName,region:j})}}catch(k){l.e(k)}finally{l.f()}return{id:t,data:{regions:u,enable:c,highlight:s}}},setIntrusion:function(e){var t=this,n=this.getRegionParams(e,this.deviceId,this.form.val);Object(s["h"])(n).then((function(e){0===e.code?(t.region=n.data.regions,t.$message.success("入侵区域设置成功！")):t.$message.error("入侵区域设置失败！")}))["finally"]((function(){t.getCameraImg(t.deviceId)}))},getCameraImg:function(e){this.img=this.baseApi+"/device/"+e+"/capture"},ptzController:function(e){var t={id:this.deviceId,data:{x:this.direct[e][0],y:this.direct[e][1],z:this.direct[e][2]}};Object(s["g"])(t).then((function(e){}))},handleCameraChange:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var a,i,r,o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.camerasMap[t.deviceId],t.infoDialog.title="配置监控："+a.name,t.infoDialog.id=t.deviceId,t.infoDialog.AIId=a.ai_project_id,n.next=6,Object(s["c"])(e);case 6:i=n.sent,r=i.regions,o=i.enable,c=i.highlight,t.form.val={enable:o,highlight:c},t.region=r,t.getCameraImg(e);case 13:case"end":return n.stop()}}),n)})))()},getAllCameraData:function(){var e=this;Object(s["b"])().then((function(t){e.cameras=t.device_list||[],e.cameras.forEach((function(t){e.camerasMap[t.id]=t}))}))["finally"]((function(){e.cameraLoading=!1}))},getPopupContainer:c["b"]}},h=d,g=(n("2b65"),n("2877")),f=Object(g["a"])(h,a,i,!1,null,"1d4b54e2",null);t["default"]=f.exports}}]);