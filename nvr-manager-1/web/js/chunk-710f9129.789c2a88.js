(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-710f9129"],{"3a82":function(t,n,e){"use strict";e.r(n);var a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{staticClass:"table-operator"},[e("a-button",{attrs:{slot:"extra",type:"primary"},on:{click:function(n){return t.linkTo(1,1)}},slot:"extra"},[e("a-icon",{attrs:{type:"plus"}}),t._v("新增录像机 ")],1)],1),e("a-table",{attrs:{rowKey:"id",columns:t.columns,dataSource:t.pageData.records,loading:t.pageData.tableLoading,pagination:!1,expandedRowKeys:t.expandedRowKeys,expandRowByClick:""},on:{expandedRowsChange:t.handleRowsChange},scopedSlots:t._u([{key:"status",fn:function(n){return e("span",{},[e("a-tag",{attrs:{color:n?"green":"red"}},[t._v(t._s(n?"在线":"离线"))])],1)}},{key:"action",fn:function(n,a){return e("span",{},[e("a",{on:{click:function(n){return n.stopPropagation(),t.linkToConfig(1,a.id)}}},[t._v("新增子监控")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{on:{click:function(n){return n.stopPropagation(),t.linkTo(0,a.id,a.name)}}},[t._v("修改")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(n){return t.batchDelete(a.id)},click:function(t){t.stopPropagation()}}},[e("a",{staticStyle:{color:"#ff4d4f"},on:{click:function(t){t.stopPropagation()}}},[t._v("删除")])])],1)}}])},[e("a-table",{attrs:{slot:"expandedRowRender",rowKey:"id",columns:t.vcrCameraColumns,"data-source":t.vcrCameraList,pagination:!1},slot:"expandedRowRender",scopedSlots:t._u([{key:"stream",fn:function(n){return e("span",{},[t._v(" "+t._s(n?t.streams[n]:"主码流")+" ")])}},{key:"enable_forward",fn:function(n,a){return e("span",{},[e("a-switch",{attrs:{"checked-children":"开启","un-checked-children":"关闭",checked:a.enable_forward},on:{change:function(n){return t.handleEnableForwardChange(n,a)}}})],1)}},{key:"action",fn:function(n,a){return e("span",{},[a.ai_task_enable?t._e():[e("a",{on:{click:function(n){return t.openMonitor(a.id,a.ai_project_id)}}},[t._v("启用")]),e("a-divider",{attrs:{type:"vertical"}})],a.ai_task_enable?[e("a-popconfirm",{attrs:{title:"确定停止监控吗?"},on:{confirm:function(){return t.stopMonitor(a.id)}}},[e("a",{staticStyle:{color:"#ff4d4f"},attrs:{href:"javascript:;"}},[t._v("停止")])]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{on:{click:function(n){return t.openVideo(a.id,a.name,a.ai_http_stream)}}},[t._v("播放")]),e("a-divider",{attrs:{type:"vertical"}})]:t._e(),e("a",{on:{click:function(n){return t.configAIServer(a.id,a.name)}}},[t._v("配置")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{on:{click:function(n){return t.linkToConfig(0,a.nvr_id,a)}}},[t._v("修改")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(n){return t.deleteCamera(a.nvr_id,a.nvr_channel)}}},[e("a",{staticStyle:{color:"#ff4d4f"}},[t._v("删除")])])],2)}}])})],1),e("a-drawer",{attrs:{title:t.infoDialog.title,visible:t.infoDialog.show,width:"680px",center:""},on:{"update:visible":function(n){return t.$set(t.infoDialog,"show",n)},close:function(n){t.infoDialog.show=!1}}},[e(t.infoDialog.component,{tag:"component",attrs:{"current-info":t.infoDialog},on:{emitToParent:t.getChildValue}})],1),e("a-modal",{attrs:{visible:t.modal.show,title:t.modal.title,footer:null,width:t.modal.width,"body-style":{textAlign:"center"},centered:"",destroyOnClose:""},on:{"update:visible":function(n){return t.$set(t.modal,"show",n)},cancel:function(n){t.modal.show=!1}}},[e("VideoPlayer",{attrs:{"current-info":t.modal}})],1)],1)},i=[],o=(e("d3b7"),e("3ca3"),e("ddb0"),e("ac1f"),e("5319"),e("4160"),e("159b"),e("b0c0"),e("abc2")),r=e("5739"),c=e("52bb"),d=[{title:"名称",dataIndex:"name"},{title:"IP",dataIndex:"ip"},{title:"在线状态",dataIndex:"online",scopedSlots:{customRender:"status"}},{title:"品牌",dataIndex:"manufacturer"},{title:"型号",dataIndex:"model"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],s=[{title:"名称",dataIndex:"name",width:"10%"},{title:"编号",dataIndex:"id",width:"15%"},{title:"通道编号",dataIndex:"nvr_channel",width:"5%"},{title:"码流类型",dataIndex:"stream",width:"10%",scopedSlots:{customRender:"stream"}},{title:"云转发",dataIndex:"enable_forward",width:"10%",scopedSlots:{customRender:"enable_forward"}},{title:"操作",dataIndex:"action",width:"20%",scopedSlots:{customRender:"action"}}],l={components:{Info:function(){return e.e("chunk-2d231546").then(e.bind(null,"efa0"))},Config:function(){return e.e("chunk-2d22db65").then(e.bind(null,"f951"))},ConfigAI:function(){return e.e("chunk-2d0bd75b").then(e.bind(null,"2ba6"))},VideoPlayer:function(){return e.e("chunk-2f72768d").then(e.bind(null,"7dc4"))}},data:function(){return{streams:{0:"主码流",1:"主码流",2:"子码流"},vcrCameraColumns:s,expandedRowKeys:[],expandedRowKey:0,vcrCameraList:[],vcrCamerasMap:{},columns:d,queryParam:{},pageData:{tableLoading:!1,records:[]},infoDialog:{component:"Info",show:!1,title:"新增录像机",type:"add",id:""},modal:{show:!1,type:"flv",title:"",url:""}}},created:function(){this.getList()},methods:{openVideo:function(t,n,e){this.modal={id:t,show:!0,title:n,width:"1080px",live:!0,isContorl:!1,url:e.replace("localhost",location.host)}},handleEnableForwardChange:function(t,n){var e=this,a=t?o["o"]:o["a"],i=n.id;a(i).then((function(t){0===t.code&&e.getList()}))},openMonitor:function(t,n){var e=this;n?Object(c["p"])({id:t}).then((function(t){0===t.code?e.$message.success("启用成功"):e.$message.error(t.message)}))["finally"]((function(){e.getList()})):this.$message.error("请为设备关联AI项目")},stopMonitor:function(t){var n=this;Object(c["q"])({id:t}).then((function(t){0===t.code?n.$message.success("监控已停止"):n.$message.error(t.message)}))["finally"]((function(){n.getList()}))},configAIServer:function(t,n){this.infoDialog={component:"ConfigAI",show:!0,title:"配置监控："+n,id:t}},deleteCamera:function(t,n){var e=this,a={id:t,nvr_channel:n};Object(r["d"])(a).then((function(t){e.$message.success("删除成功！"),e.getList()}))},handleRowsChange:function(t){if(!t||!t.length)return this.expandedRowKeys=[],this.vcrCameraList=[],void(this.expandedRowKey=0);var n=t[t.length-1];this.expandedRowKeys=[n],this.expandedRowKey=n,this.vcrCameraList=this.vcrCamerasMap[n]},getList:function(){var t=this;this.pageData.tableLoading=!0,Object(r["f"])().then((function(n){var e=n.hiknvr_list||[];for(var a in e)null==e[a]["manufacturer"]&&(e[a]["manufacturer"]="海康威视");t.pageData.records=e,e.forEach((function(n){t.vcrCamerasMap[n.id]=n.cameras})),t.vcrCameraList=t.vcrCamerasMap[t.expandedRowKey]||[]}))["finally"]((function(n){t.pageData.tableLoading=!1}))},getChildValue:function(t){this.infoDialog.show=!1,t&&this.getList()},linkToConfig:function(t,n,e){this.infoDialog={component:"Config",show:!0,isAdd:t,title:t?"新增监控":"配置监控："+e.name,nvr_id:n,vcrCamera:e,id:t?"":e.id}},linkTo:function(t,n,e){this.infoDialog={component:"Info",show:!0,isAdd:t,title:t?"新增录像机":"修改录像机："+e,id:n}},batchDelete:function(t){var n=this;Object(r["c"])(t).then((function(t){n.$message.success("删除成功！"),n.getList()}))}}},u=l,f=e("2877"),h=Object(f["a"])(u,a,i,!1,null,null,null);n["default"]=h.exports},5739:function(t,n,e){"use strict";e.d(n,"f",(function(){return i})),e.d(n,"e",(function(){return o})),e.d(n,"g",(function(){return r})),e.d(n,"a",(function(){return c})),e.d(n,"c",(function(){return d})),e.d(n,"d",(function(){return s})),e.d(n,"b",(function(){return l})),e.d(n,"h",(function(){return u}));var a=e("b775");function i(t){return Object(a["b"])({url:"/hiknvr",method:"get",params:t})}function o(t){return Object(a["b"])({url:"/hiknvr/"+t,method:"get"})}function r(t){return Object(a["b"])({url:"/hiknvr/"+t.id,method:"patch",data:t})}function c(t){return Object(a["b"])({url:"/hiknvr",method:"post",data:t})}function d(t){return Object(a["b"])({url:"/hiknvr/"+t,method:"delete"})}function s(t){return Object(a["b"])({url:"/hiknvr/"+t.id+"/"+t.nvr_channel,method:"delete"})}function l(t,n){return Object(a["b"])({url:"/hiknvr/"+n,method:"post",data:t})}function u(t,n){return Object(a["b"])({url:"/hiknvr/"+n+"/"+t.nvr_channel,method:"patch",data:t})}}}]);