(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e667f32"],{"4a22":function(t,e,a){"use strict";a("fd4a")},dbdf:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main-content"},[a("a-card",[a("div",{staticClass:"table-operator"},[a("a-button",{attrs:{slot:"extra",type:"primary"},on:{click:t.startDriver},slot:"extra"},[a("a-icon",{attrs:{type:"play-circle"}}),t._v("启动 ")],1),a("a-button",{attrs:{slot:"extra",type:"primary"},on:{click:t.stopDriver},slot:"extra"},[a("a-icon",{attrs:{type:"pause-circle"}}),t._v("停止 ")],1),a("a-button",{attrs:{slot:"extra",type:"primary"},on:{click:function(e){return t.openDraw()}},slot:"extra"},[a("a-icon",{attrs:{type:"sync"}}),t._v("更新 ")],1)],1),a("a-table",{attrs:{rowKey:"device_id",columns:t.columns,dataSource:t.pageData.records,loading:t.pageData.tableLoading,pagination:!1},scopedSlots:t._u([{key:"action",fn:function(e,n){return a("span",{},[a("a",{on:{click:function(e){return t.openDraw(n)}}},[t._v("设备详情")])])}}])})],1),a("a-drawer",{attrs:{title:t.infoDialog.title,visible:t.infoDialog.show,width:"800px",center:""},on:{"update:visible":function(e){return t.$set(t.infoDialog,"show",e)},close:function(e){t.infoDialog.show=!1}}},[t.infoDialog.info?[a("p",[t._v("上报通道")]),a("a-table",{attrs:{rowKey:"channel",columns:t.reportColumns,dataSource:t.infoDialog.info.report,pagination:!1},scopedSlots:t._u([{key:"data",fn:function(e){return a("span",{},[t._v(" "+t._s(e||"空")+" ")])}},{key:"status",fn:function(e){return a("span",{},[a("a-tag",{attrs:{color:e&&e.ok?"green":"orange"}},[t._v(t._s(e&&e.ok?"正常":e.message))])],1)}}],null,!1,2334199655)}),a("p",[t._v("下发通道")]),a("a-table",{attrs:{rowKey:"channel",columns:t.commandColumns,dataSource:t.infoDialog.info.command,pagination:!1},scopedSlots:t._u([{key:"status",fn:function(e){return a("span",{},[a("a-tag",{attrs:{color:e&&e.ok?"green":"orange"}},[t._v(t._s(e&&e.ok?"正常":e.message))])],1)}}],null,!1,791323887)})]:[a("div",{staticStyle:{"margin-bottom":"24px"}},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.getCode(0)}}},[t._v("IOT驱动器设计模板")]),a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.getCode(1)}}},[t._v("实验室气象站驱动代码")])],1),a("code-editor",{model:{value:t.driver_code,callback:function(e){t.driver_code=e},expression:"driver_code"}}),a("a-form-item",{staticClass:"form-btn"},[a("a-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确定")])],1)]],2)],1)},o=[],i=a("c964"),r=(a("96cf"),a("d3b7"),a("ac1f"),a("1276"),a("4de4"),a("8593")),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"json-editor"},[a("textarea",{ref:"textarea"})])},c=[],d=a("56b3"),l=a.n(d),u=(a("0dd0"),a("a7be"),a("0109"),a("db91"),a("8822"),a("d2de"),{name:"CodeEditor",props:{value:{type:[String,Object],default:""}},data:function(){return{jsonEditor:!1,isLint:!1}},watch:{value:function(t){var e=this.jsonEditor.getValue();t!==e&&this.jsonEditor.setValue(this.value)}},mounted:function(){var t=this;this.jsonEditor=l.a.fromTextArea(this.$refs.textarea,{lineNumbers:!0,mode:"python",gutters:["CodeMirror-lint-markers"],theme:"dracula",lint:!0,readOnly:!1}),this.value&&this.jsonEditor.setValue(this.value),this.jsonEditor.on("change",(function(e){var a=e.getValue();t.$emit("changed",a),t.$emit("input",a)})),this.jsonEditor.on("blur",(function(e){t.$emit("blur",e.getValue())}))},methods:{getValue:function(){return this.jsonEditor.getValue()}}}),f=u,p=(a("4a22"),a("2877")),v=Object(p["a"])(f,s,c,!1,null,"1e1089d7",null),g=v.exports,m=a("bc3a"),h=a.n(m),b=[{title:"物联网设备ID",dataIndex:"device_id"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],_=[{title:"上报通道名",dataIndex:"channel"},{title:"采集数据间隔",dataIndex:"interval"},{title:"上报数据",dataIndex:"data",scopedSlots:{customRender:"data"}},{title:"通道状态",dataIndex:"status",scopedSlots:{customRender:"status"}}],y=[{title:"下发指令通道名",dataIndex:"channel"},{title:"通道状态",dataIndex:"status",scopedSlots:{customRender:"status"}}],x={components:{CodeEditor:g},data:function(){return{columns:b,reportColumns:_,commandColumns:y,codes:[],driver_code:"",pageData:{tableLoading:!1,records:[]},infoDialog:{show:!1,title:"设备详情",info:{}}}},created:function(){this.getList(),this.loadCodeFile()},methods:{submit:function(){var t=this;Object(r["v"])({driver_code:this.driver_code}).then((function(e){0===e.code&&t.$message.success("更新成功！"),t.getList()}))["finally"]((function(){t.infoDialog.show=!1}))},loadCodeFile:function(){var t=this;h.a.get("/static/driverCodeSample.txt").then((function(e){t.codes=e.data&&e.data.split("################")}))},getCode:function(t){this.driver_code=this.codes[t]},stopDriver:function(){var t=this;Object(r["t"])().then((function(e){t.$message.success("驱动已停止！")}))["finally"]((function(){t.getList()}))},startDriver:function(){var t=this;Object(r["s"])().then((function(e){0===e.code&&t.$message.success("启动成功！")}))["finally"]((function(){t.getList()}))},getList:function(){var t=this;this.pageData.tableLoading=!0,Object(r["c"])().then((function(e){var a=e.status||[];t.driver_code=e.driver_code,t.pageData.records=a}))["finally"]((function(e){t.pageData.tableLoading=!1}))},openDraw:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t){a.next=4;break}return a.next=3,e.getList();case 3:t=(e.pageData.records||[]).filter((function(e){return e.device_id===t.device_id}))[0];case 4:e.infoDialog={show:!0,title:t?t.device_id:"更新驱动代码",info:t&&t.device_status};case 5:case"end":return a.stop()}}),a)})))()}}},D=x,w=Object(p["a"])(D,n,o,!1,null,null,null);e["default"]=w.exports},fd4a:function(t,e,a){}}]);